<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- ======================================================================= -->
    <!-- List View -->
    <!-- ======================================================================= -->
    <record id="view_unit_commission_tree" model="ir.ui.view">
        <field name="name">highfive.unit.commission.list</field>
        <field name="model">highfive.unit.commission</field>
        <field name="arch" type="xml">
            <list string="Commission Rates"
                  decoration-success="status == 'active' and type == 'scheduled'"
                  decoration-info="type == 'default'"
                  decoration-muted="status == 'expired'"
                  decoration-warning="status == 'upcoming'">
                <field name="unit_id"/>
                <field name="name"/>
                <field name="type" widget="badge"/>
                <field name="status" widget="badge"
                       decoration-success="status == 'active'"
                       decoration-warning="status == 'upcoming'"
                       decoration-danger="status == 'expired'"
                       optional="show"/>
                <field name="online_rate_display" string="Online"/>
                <field name="cash_rate_display" string="Cash"/>
                <field name="start_at" optional="hide"/>
                <field name="end_at" optional="hide"/>
                <field name="highfive_commission_id" optional="hide"/>
                <field name="active" widget="boolean_toggle"/>
            </list>
        </field>
    </record>

    <!-- ======================================================================= -->
    <!-- Form View -->
    <!-- ======================================================================= -->
    <record id="view_unit_commission_form" model="ir.ui.view">
        <field name="name">highfive.unit.commission.form</field>
        <field name="model">highfive.unit.commission</field>
        <field name="arch" type="xml">
            <form string="Commission Rate">
                <header>
                    <!-- Status Badge -->
                    <field name="status" widget="statusbar"
                           statusbar_visible="upcoming,active,expired"
                           invisible="type != 'scheduled'"/>
                </header>

                <sheet>
                    <!-- Button Box -->
                    <div class="oe_button_box" name="button_box">
                        <field name="active" widget="boolean_button"
                               options="{'terminology': 'active'}"/>
                    </div>

                    <!-- Title -->
                    <div class="oe_title" invisible="not name">
                        <h1>
                            <field name="name" placeholder="e.g., Ramadan Special Offer"/>
                        </h1>
                    </div>

                    <!-- Basic Info -->
                    <group>
                        <group string="Basic Information">
                            <field name="unit_id"
                                   options="{'no_create': True, 'no_open': True}"/>
                            <field name="type" widget="radio"/>
                            <field name="highfive_commission_id"
                                   placeholder="Auto-filled from HighFive"
                                   readonly="1"/>
                        </group>
                        <group string="Current Rates (Display)">
                            <field name="online_rate_display"
                                   class="text-primary fw-bold"/>
                            <field name="cash_rate_display"
                                   class="text-success fw-bold"/>
                        </group>
                    </group>

                    <!-- Commission Rates -->
                    <group string="üìä Commission Configuration">
                        <group string="Online Payment Commission">
                            <label for="online_booking" string="Rate (JSON)"/>
                            <div>
                                <field name="online_booking"
                                       widget="text"
                                       class="o_field_text"
                                       placeholder='{"type": "percentage", "value": 15}'
                                       nolabel="1"/>
                                <div class="text-muted small mt-1">
                                    <i class="fa fa-info-circle"/>
                                    Format: {"type": "percentage", "value": 15}
                                </div>
                            </div>
                        </group>
                        <group string="Cash Payment Commission">
                            <label for="cash_booking" string="Rate (JSON)"/>
                            <div>
                                <field name="cash_booking"
                                       widget="text"
                                       class="o_field_text"
                                       placeholder='{"type": "percentage", "value": 10}'
                                       nolabel="1"/>
                                <div class="text-muted small mt-1">
                                    <i class="fa fa-info-circle"/>
                                    Format: {"type": "percentage", "value": 10}
                                </div>
                            </div>
                        </group>
                    </group>

                    <!-- Scheduled Commission Dates -->
                    <group string="üìÖ Scheduled Period"
                           invisible="type != 'scheduled'">
                        <group>
                            <field name="start_at"
                                   required="type == 'scheduled'"/>
                        </group>
                        <group>
                            <field name="end_at"
                                   required="type == 'scheduled'"/>
                        </group>
                    </group>

                    <!-- Notebook -->
                    <notebook>
                        <!-- Help Tab -->
                        <page string="‚ÑπÔ∏è Help &amp; Examples" name="help">
                            <group>
                                <div class="alert alert-info">
                                    <h4><i class="fa fa-book"/> Commission Format Guide:</h4>

                                    <h5 class="mt-3">üìå Basic Structure:</h5>
                                    <pre class="bg-light p-2">
{
    "type": "percentage" or "fixed",
    "value": 15
}</pre>

                                    <h5 class="mt-3">üí° Examples:</h5>
                                    <ul>
                                        <li>
                                            <strong>15% Commission:</strong><br/>
                                            <code>{"type": "percentage", "value": 15}</code>
                                        </li>
                                        <li>
                                            <strong>10% Commission:</strong><br/>
                                            <code>{"type": "percentage", "value": 10}</code>
                                        </li>
                                        <li>
                                            <strong>Fixed 50 SAR:</strong><br/>
                                            <code>{"type": "fixed", "value": 50}</code>
                                        </li>
                                    </ul>

                                    <h5 class="mt-3">üéØ Commission Types:</h5>
                                    <ul>
                                        <li>
                                            <strong>Default:</strong> Used when no scheduled commission is active
                                        </li>
                                        <li>
                                            <strong>Scheduled:</strong> Used during specific date range (promotions, special offers)
                                        </li>
                                    </ul>

                                    <h5 class="mt-3">‚öôÔ∏è How It Works:</h5>
                                    <ol>
                                        <li>When creating a booking, Odoo checks for active scheduled commission</li>
                                        <li>If found and booking date is within range ‚Üí use scheduled commission</li>
                                        <li>Otherwise ‚Üí use default commission</li>
                                        <li>Commission amount is calculated automatically</li>
                                    </ol>

                                    <div class="alert alert-warning mt-3">
                                        <strong><i class="fa fa-warning"/> Important Notes:</strong>
                                        <ul>
                                            <li>Each unit can have only ONE default commission</li>
                                            <li>Multiple scheduled commissions are allowed</li>
                                            <li>JSON format must be valid</li>
                                            <li>Value must be numeric</li>
                                        </ul>
                                    </div>
                                </div>
                            </group>
                        </page>

                        <!-- API Info Tab (for developers) -->
                        <page string="üîß API Reference" name="api_info" groups="base.group_system">
                            <group>
                                <div class="alert alert-success">
                                    <h4><i class="fa fa-code"/> Developer Information:</h4>

                                    <h5 class="mt-3">üìù Fields:</h5>
                                    <table class="table table-sm">
                                        <tr>
                                            <td><strong>highfive_commission_id</strong></td>
                                            <td>Original ID from HighFive database</td>
                                        </tr>
                                        <tr>
                                            <td><strong>name</strong></td>
                                            <td>Commission name/description</td>
                                        </tr>
                                        <tr>
                                            <td><strong>status</strong></td>
                                            <td>Computed: upcoming/active/expired</td>
                                        </tr>
                                    </table>

                                    <h5 class="mt-3">üî® Key Methods:</h5>
                                    <ul>
                                        <li><code>get_commission_data(payment_method)</code> - Get full commission info</li>
                                        <li><code>calculate_commission_amount(base, method)</code> - Calculate amount</li>
                                        <li><code>get_active_commission(unit_id, date)</code> - Find active commission</li>
                                        <li><code>get_commission_for_booking(...)</code> - All-in-one method</li>
                                    </ul>

                                    <h5 class="mt-3">üíª Usage Example:</h5>
                                    <pre class="bg-light p-2">
# Get commission info
commission = env['highfive.unit.commission'].browse(10)
data = commission.get_commission_data('online')
# Returns: {
#   'type': 'percentage',
#   'value': 15.0,
#   'commission_id': 10,
#   'commission_name': 'Ramadan Special'
# }

# Calculate amount
amount = commission.calculate_commission_amount(100.00, 'online')
# Returns: 15.00

# All-in-one for booking
result = env['highfive.unit.commission'].get_commission_for_booking(
    unit_id=5,
    booking_date=datetime.now(),
    payment_method='online',
    base_amount=100.00
)
# Returns full result with commission record and calculated amount</pre>
                                </div>
                            </group>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <!-- ======================================================================= -->
    <!-- Search View -->
    <!-- ======================================================================= -->
    <record id="view_unit_commission_search" model="ir.ui.view">
        <field name="name">highfive.unit.commission.search</field>
        <field name="model">highfive.unit.commission</field>
        <field name="arch" type="xml">
            <search>
                <field name="unit_id"/>
                <field name="name"/>
                <field name="highfive_commission_id"/>

                <separator/>

                <!-- Filters -->
                <filter string="Default Commissions" name="filter_default"
                        domain="[('type', '=', 'default')]"/>
                <filter string="Scheduled Commissions" name="filter_scheduled"
                        domain="[('type', '=', 'scheduled')]"/>

                <separator/>

                <filter string="Active" name="filter_active_status"
                        domain="[('status', '=', 'active')]"/>
                <filter string="Upcoming" name="filter_upcoming"
                        domain="[('status', '=', 'upcoming')]"/>
                <filter string="Expired" name="filter_expired"
                        domain="[('status', '=', 'expired')]"/>

                <separator/>

                <filter string="Active Records" name="filter_active"
                        domain="[('active', '=', True)]"/>
                <filter string="Archived" name="filter_archived"
                        domain="[('active', '=', False)]"/>

                <separator/>

                <!-- Group By -->
                <group expand="0" string="Group By">
                    <filter string="Unit" name="group_unit"
                            context="{'group_by': 'unit_id'}"/>
                    <filter string="Type" name="group_type"
                            context="{'group_by': 'type'}"/>
                    <filter string="Status" name="group_status"
                            context="{'group_by': 'status'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- ======================================================================= -->
    <!-- Action -->
    <!-- ======================================================================= -->
    <record id="action_unit_commission" model="ir.actions.act_window">
        <field name="name">Commission Rates</field>
        <field name="res_model">highfive.unit.commission</field>
        <field name="view_mode">list,form</field>
        <field name="context">{
            'search_default_filter_active': 1,
            'search_default_filter_active_status': 1
        }</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No commission rates configured
            </p>
            <p>
                Create commission rates to define how much HighFive earns from each booking.
            </p>
            <ul>
                <li><strong>Default:</strong> Always-active commission rate</li>
                <li><strong>Scheduled:</strong> Special offers for specific periods</li>
            </ul>
        </field>
    </record>
</odoo>