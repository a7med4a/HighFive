<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- ================================================================ -->
    <!-- TREE VIEW -->
    <!-- ================================================================ -->
    <record id="view_unit_commission_tree" model="ir.ui.view">
        <field name="name">highfive.unit.commission.tree</field>
        <field name="model">highfive.unit.commission</field>
        <field name="arch" type="xml">
            <list string="Unit Commissions" decoration-muted="active == False"
                  decoration-info="status == 'upcoming'"
                  decoration-success="status == 'active'"
                  decoration-danger="status == 'expired'">
                <field name="name"/>
                <field name="unit_id"/>
                <field name="type"/>
                <field name="start_date"/>
                <field name="end_date"/>
                <field name="online_display" string="Online"/>
                <field name="cash_display" string="Cash"/>
                <field name="walkin_display" string="Walk-in"/>
                <field name="status" widget="badge"
                       decoration-info="status == 'upcoming'"
                       decoration-success="status == 'active'"
                       decoration-danger="status == 'expired'"/>
                <field name="active" invisible="1"/>
            </list>
        </field>
    </record>

    <!-- ================================================================ -->
    <!-- FORM VIEW -->
    <!-- ================================================================ -->
    <record id="view_unit_commission_form" model="ir.ui.view">
        <field name="name">highfive.unit.commission.form</field>
        <field name="model">highfive.unit.commission</field>
        <field name="arch" type="xml">
            <form string="Unit Commission">
                <header>
                    <field name="status" widget="statusbar"
                           statusbar_visible="upcoming,active,expired"/>
                </header>
                <sheet>
                    <!-- Title -->
                    <div class="oe_title">
                        <h1>
                            <field name="name" placeholder="Commission Name (e.g., Ramadan Special)"/>
                        </h1>
                    </div>

                    <group>
                        <group name="basic_info" string="Basic Information">
                            <field name="unit_id"
                                   options="{'no_create': True, 'no_open': True}"/>
                            <field name="type" widget="radio"/>
                            <field name="highfive_commission_id" readonly="1" invisible="highfive_commission_id == False"/>
                            <field name="currency_id" invisible="1"/>
                        </group>

                        <group name="schedule" string="Schedule" invisible="type == 'default'">
                            <field name="start_date" required="type == 'scheduled'"/>
                            <field name="end_date" required="type == 'scheduled'"/>
                            <field name="active"/>
                        </group>
                    </group>

                    <notebook>
                        <!-- Tab 1: Regular Bookings -->
                        <page string="Regular Bookings" name="regular_bookings">
                            <group>
                                <group string="Online Booking">
                                    <label for="commission_online_percent"/>
                                    <div class="o_row">
                                        <field name="commission_online_percent" class="oe_inline"/>
                                        <span class="oe_inline">%</span>
                                        <span class="oe_inline mx-2">+</span>
                                        <field name="commission_online_fixed" class="oe_inline"/>
                                    </div>
                                </group>

                                <group string="Cash Booking">
                                    <label for="commission_cash_percent"/>
                                    <div class="o_row">
                                        <field name="commission_cash_percent" class="oe_inline"/>
                                        <span class="oe_inline">%</span>
                                        <span class="oe_inline mx-2">+</span>
                                        <field name="commission_cash_fixed" class="oe_inline"/>
                                    </div>
                                </group>
                            </group>

                            <group>
                                <group string="Walk-in Booking">
                                    <label for="commission_walkin_percent"/>
                                    <div class="o_row">
                                        <field name="commission_walkin_percent" class="oe_inline"/>
                                        <span class="oe_inline">%</span>
                                        <span class="oe_inline mx-2">+</span>
                                        <field name="commission_walkin_fixed" class="oe_inline"/>
                                    </div>
                                </group>

                                <group string="Linked Booking">
                                    <label for="commission_linked_percent"/>
                                    <div class="o_row">
                                        <field name="commission_linked_percent" class="oe_inline"/>
                                        <span class="oe_inline">%</span>
                                        <span class="oe_inline mx-2">+</span>
                                        <field name="commission_linked_fixed" class="oe_inline"/>
                                    </div>
                                </group>
                            </group>
                        </page>

                        <!-- Tab 2: Public Events -->
                        <page string="Public Events" name="public_events">
                            <group>
                                <group string="Online Public Event">
                                    <label for="commission_online_event_percent"/>
                                    <div class="o_row">
                                        <field name="commission_online_event_percent" class="oe_inline"/>
                                        <span class="oe_inline">%</span>
                                        <span class="oe_inline mx-2">+</span>
                                        <field name="commission_online_event_fixed" class="oe_inline"/>
                                    </div>
                                </group>

                                <group string="Cash Public Event">
                                    <label for="commission_cash_event_percent"/>
                                    <div class="o_row">
                                        <field name="commission_cash_event_percent" class="oe_inline"/>
                                        <span class="oe_inline">%</span>
                                        <span class="oe_inline mx-2">+</span>
                                        <field name="commission_cash_event_fixed" class="oe_inline"/>
                                    </div>
                                </group>
                            </group>
                        </page>

                        <!-- Tab 3: Examples -->
                        <page string="Examples" name="examples">
                            <group>
                                <group string="Commission Calculation Examples">
                                    <label for="commission_online_percent" string="Example: Online Booking"/>
                                    <div>
                                        <p>Base Amount: 100 SAR</p>
                                        <p>Commission = (100 × <field name="commission_online_percent" readonly="1" class="oe_inline"/>%) + <field name="commission_online_fixed" readonly="1" class="oe_inline"/> SAR</p>
                                    </div>

                                    <label  for="commission_cash_percent" string="Example: Cash Booking"/>
                                    <div>
                                        <p>Base Amount: 100 SAR</p>
                                        <p>Commission = (100 × <field name="commission_cash_percent" readonly="1" class="oe_inline"/>%) + <field name="commission_cash_fixed" readonly="1" class="oe_inline"/> SAR</p>
                                    </div>
                                </group>

                                <group string="Notes">
                                    <div>
                                        <ul>
                                            <li><strong>Default Commission:</strong> Applied when no scheduled commission is active</li>
                                            <li><strong>Scheduled Commission:</strong> Applied during specified date range</li>
                                            <li><strong>Priority:</strong> Scheduled > Default</li>
                                            <li><strong>Formula:</strong> Commission = (Base × Percent) + Fixed</li>
                                            <li><strong>Tax:</strong> Applied after commission calculation</li>
                                        </ul>
                                    </div>
                                </group>
                            </group>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <!-- ================================================================ -->
    <!-- SEARCH VIEW -->
    <!-- ================================================================ -->
    <record id="view_unit_commission_search" model="ir.ui.view">
        <field name="name">highfive.unit.commission.search</field>
        <field name="model">highfive.unit.commission</field>
        <field name="arch" type="xml">
            <search string="Search Commissions">
                <field name="name" string="Commission Name"/>
                <field name="unit_id" string="Unit"/>
                <field name="highfive_commission_id" string="HighFive ID"/>

                <filter string="Default" name="filter_default"
                        domain="[('type', '=', 'default')]"/>
                <filter string="Scheduled" name="filter_scheduled"
                        domain="[('type', '=', 'scheduled')]"/>

                <separator/>

                <filter string="Active" name="filter_active"
                        domain="[('status', '=', 'active')]"/>
                <filter string="Upcoming" name="filter_upcoming"
                        domain="[('status', '=', 'upcoming')]"/>
                <filter string="Expired" name="filter_expired"
                        domain="[('status', '=', 'expired')]"/>

                <separator/>

                <filter string="Archived" name="filter_archived"
                        domain="[('active', '=', False)]"/>

                <group expand="0" string="Group By">
                    <filter string="Unit" name="group_unit"
                            context="{'group_by': 'unit_id'}"/>
                    <filter string="Type" name="group_type"
                            context="{'group_by': 'type'}"/>
                    <filter string="Status" name="group_status"
                            context="{'group_by': 'status'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- ================================================================ -->
    <!-- ACTION -->
    <!-- ================================================================ -->
    <record id="action_unit_commission" model="ir.actions.act_window">
        <field name="name">Unit Commissions</field>
        <field name="res_model">highfive.unit.commission</field>
        <field name="view_mode">list,form</field>
        <field name="context">{
            'search_default_filter_active': 1
        }</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create your first commission rule!
            </p>
            <p>
                Set commission rates for your units based on booking types.
                You can create:
                <ul>
                    <li><b>Default Commission:</b> Always active unless overridden</li>
                    <li><b>Scheduled Commission:</b> Active during specific dates (e.g., Ramadan special)</li>
                </ul>
            </p>
        </field>
    </record>

    <!-- ================================================================ -->
    <!-- MENU ITEM -->
    <!-- ================================================================ -->
    <menuitem id="menu_unit_commission"
              name="Commissions"
              parent="highfive_core.highfive_config_menu"
              action="action_unit_commission"
              sequence="30"/>

</odoo>